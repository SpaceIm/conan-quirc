--- a/lib/identify.c
+++ b/lib/identify.c
@@ -180,7 +180,7 @@ static uint8_t otsu(const struct quirc *q)
 	int numPixels = q->w * q->h;
 
 	// Calculate histogram
-	const int HISTOGRAM_SIZE = 256;
+	#define HISTOGRAM_SIZE 256
 	unsigned int histogram[HISTOGRAM_SIZE];
 	memset(histogram, 0, (HISTOGRAM_SIZE) * sizeof(unsigned int));
 	uint8_t* ptr = q->image;
@@ -192,7 +192,8 @@ static uint8_t otsu(const struct quirc *q)
 
 	// Calculate weighted sum of histogram values
 	int sum = 0;
-	for (int i = 0; i < HISTOGRAM_SIZE; ++i) {
+	int i;
+	for (i = 0; i < HISTOGRAM_SIZE; ++i) {
 		sum += i * histogram[i];
 	}
 
@@ -201,7 +202,7 @@ static uint8_t otsu(const struct quirc *q)
 	int q1 = 0;
 	double max = 0;
 	uint8_t threshold = 0;
-	for (int i = 0; i < HISTOGRAM_SIZE; ++i) {
+	for (i = 0; i < HISTOGRAM_SIZE; ++i) {
 		// Weighted background
 		q1 += histogram[i];
 		if (q1 == 0)
